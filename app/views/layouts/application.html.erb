<!DOCTYPE html>
<html lang="ja" data-theme="sky">
  <head>
    <title><%= content_for(:title) || "WebSpecimanager" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="<%= asset_path('favicon.ico') %>" type="image/x-icon">
    <link rel="apple-touch-icon" href="<%= asset_path('favicon.ico') %>">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-[var(--page-bg)] text-[var(--fg)]" data-controller="sidebar">
    <header data-turbo-permanent>
      <%= render "shared/topbar" %>
    </header>

    <!-- モバイル専用サイドバー（md以上では非表示） -->
    <aside id="sidebar" data-turbo-permanent
           data-sidebar-target="panel"
           class="fixed top-14 bottom-0 left-0 z-50 w-[var(--sidebar-w)]
                  transform transition-transform duration-200
                  -translate-x-full md:hidden">
      <div class="h-full bg-[var(--sidebar-bg)] text-[var(--sidebar-fg)] shadow-[var(--shadow-sep-v)]">
        <nav class="p-3 space-y-1 overflow-y-auto text-xs">
          <%= render "shared/nav_links", kind: :sidebar %>
          <div class="mb-2 h-[1px] bg-gradient-to-r from-gray-300 via-gray-500 to-gray-300"></div>
          <div class="items-center justify-center rounded-md px-1 py-1 text-xs hover:bg-black/8">
            <%= render "shared/sign_in_out_link" %>
          </div>
        </nav>
      </div>
    </aside>

    <!-- モバイル用バックドロップ（md以上は非表示） -->
    <div id="sidebar-backdrop" data-sidebar-target="backdrop"
         class="fixed inset-x-0 top-14 bottom-0 z-40 hidden bg-black/40 md:hidden"
         data-action="click->sidebar#close"></div>

    <!-- コンテンツ：サイドバー常設をやめたので左余白は不要 -->
    <main id="content" class="min-h-screen transition-[padding] duration-200 pt-14">
      <div class="p-4 md:p-8"><%= yield %></div>
    </main>
  </body>
</html>
